<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Resort Finder</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <script src="https://kit.fontawesome.com/4cf078c340.js" crossorigin="anonymous"></script>
    <style>
        body {
            background-image: url(../images/backround_resort.jpg);
            background-repeat: no-repeat;
            background-size: cover;
            background-color: rgba(0, 0, 0, 0.2);
            background-blend-mode: darken;
        }
    </style>
</head>

<body>
    <a href="#main" class="skip">Skip to main content</a>
    <nav class="navbar">
        <div>
            <i class="fa-solid fa-mountain"></i>
            <span class="logo">SummitSearch</span>
        </div>
        <div class="nav-links">
            <a href="index.html">Home</a> <span>|</span>
            <a href="resort.html">Resort Finder</a> <span>|</span>
            <a href="gear.html">Gear Finder</a> <span>|</span>
            <a href="howto.html">How It Works</a>
        </div>
    </nav>
    <br>
    <article class=flex-container>
        <div class="flex-nocenter">
            <header>
                <h1>Resort Finder</h1>
            </header>
            <p>Whether you want an easy relaxing day, or a day filled with adrenaline, find a resort in New York here!
                Different
                resorts provide various types of terrain and amenities, which is a big deciding factor when it comes to
                planning a trip. Finding a resort near you could be hard, so I hope this interactive map can help.</p>
        </div>
    </article>
    <br>
    <main id = "main" class="layout">
        <div id="map"></div>
        <form id="userside">
            <label for="loc">Location:</label>
            <input id="loc" placeholder="Enter an Address in New York">
            <button id="go" type = "button">Find closest</button>
            <div id="closest"></div>
        </form>
    </main>
    <script>
        const resorts = [];
        const map = L.map("map").setView([42.9, -75.5], 7);
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            maxZoom: 18,
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);
        setTimeout(() => map.invalidateSize(), 200);
        Papa.parse("ski_mtn_ny.csv", {
            download: true,
            header: true,
            skipEmptyLines: true,
            complete: function (results) {
                const rows = results.data;

                rows.forEach(row => {
                    const name = row.name;
                    const lat = parseFloat(row.latitude);
                    const lon = parseFloat(row.longitude);
                    const acres = row.skiable_area_acres;
                    const popupContent = `
            <strong>${name}</strong><br>
            Skiable area: ${acres} acres`;
                    resorts.push({ name, lat, lon });
                    L.marker([lat, lon])
                        .addTo(map)
                        .bindPopup(popupContent);
                });
            }
        });
        let userMarker;
        const redIcon = L.divIcon({
            className: "",
            html: `<div style="width:14px;height:14px;border-radius:50%;
    background:red;border:2px solid white;"></div>`,
            iconSize: [14, 14],
            iconAnchor: [7, 7]
        });

        async function geocode(q) {
            const url = `https://nominatim.openstreetmap.org/search?format=json&limit=1&q=${encodeURIComponent(q)}`;
            const data = await (await fetch(url)).json();
            if (!data.length) throw Error("Location not found, make sure to add a city and New York");
            return { lat: +data[0].lat, lon: +data[0].lon };
        }

        function miles(lat1, lon1, lat2, lon2) {
            const R = 3958.8, toRad = d => d * Math.PI / 180;
            const dLat = toRad(lat2 - lat1), dLon = toRad(lon2 - lon1);
            const a = Math.sin(dLat / 2) ** 2 + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon / 2) ** 2;
            return 2 * R * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        }

        document.getElementById("go").onclick = async () => {
            const q = document.getElementById("loc").value.trim();
            if (!q) return;
            const { lat, lon } = await geocode(q);

            if (userMarker) map.removeLayer(userMarker);
            userMarker = L.marker([lat, lon], { icon: redIcon }).addTo(map);
            map.setView([lat, lon], 9);

            const top5 = resorts
                .map(r => ({ ...r, d: miles(lat, lon, r.lat, r.lon) }))
                .sort((a, b) => a.d - b.d)
                .slice(0, 5);

            document.getElementById("closest").innerHTML =
                "<h3>5 Closest Resorts to You</h3><ol>" +
                top5.map(r => `<li>${r.name} â€” ${r.d.toFixed(1)} mi</li>`).join("") +
                "</ol>";
            setTimeout(() => map.invalidateSize(), 200);

        };
    </script>




    <!-- <img src ="../images/mont_tremblant.jpeg" alt= "mont tremblant" width ="600" height="400"> -->

    <footer>
        <hr>
        <p>&copy;2025 Tim Soron</p>
    </footer>
</body>

</html>